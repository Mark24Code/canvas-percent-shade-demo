(this["webpackJsonpcanvas-demo"]=this["webpackJsonpcanvas-demo"]||[]).push([[0],{23:function(t,e,n){},40:function(t,e,n){"use strict";n.r(e),e.default=n.p+"static/media/background.d67466eb.jpg"},41:function(t,e,n){"use strict";n.r(e),e.default=n.p+"static/media/frontend.c9daf1f4.jpg"},43:function(t,e,n){"use strict";n.r(e);var a=n(3),r=n.n(a),i=n(11),c=n.n(i),o=(n(23),n(1)),s=n.n(o),u=n(2),d=n(5),h=n(12),p=n(17),l=n(15),f=n(7),g=n(18),v=n(16),w=n(13),x=n(14),b=n.n(x),m=function(t){if(/^http:\/\/(.*)$/.test(t)){var e=t.split("://"),n=Object(f.a)(e,2),a=(n[0],n[1]);return"https://".concat(a)}return t},j=function t(e){var n=this;Object(d.a)(this,t),this.init=function(){var t=n.canvasConfig,e=t.id,a=t.width,r=t.height,i=window.document.getElementById(e);i||((i=window.document.createElement("canvas")).id=e);var c=i.getContext("2d");if(!c)throw Error("Cannot find canvas.getContext");n.c=i,n.canvas=i,n.ctx=c,n.ratio=n.getPixelRatio(),i.style.width=a+"px",i.style.height=r+"px",i.width=a*n.ratio,i.height=r*n.ratio,c.scale(n.ratio,n.ratio)},this.getPixelRatio=function(){var t=n.ctx,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},this.startDraw=Object(u.a)(s.a.mark((function t(){var e,a,r,i,c,o,u,d,h;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=n.ctx,a=n.canvasConfig.debug,!(n.drawList<=0)){t.next=4;break}return t.abrupt("return");case 4:r=Object(v.a)(n.drawList),i=0;case 7:if(!(i<r.length)){t.next=20;break}return c=r[i],o=c.id,u=c.type,d=Object(g.a)(c,["id","type"]),h=Object(w.camelCase)("draw_".concat(u)),a&&console.log("[start draw] ".concat(o||JSON.stringify(c))),e.save(),t.next=15,n[h](d);case 15:e.restore(),a&&console.log("[finished draw] ".concat(o||JSON.stringify(c)));case 17:i++,t.next=7;break;case 20:case"end":return t.stop()}}),t)}))),this.drawImage=function(){var t=Object(u.a)(s.a.mark((function t(e){var a,r,i,c,o,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.url,r=e.x,i=e.y,c=e.width,o=e.height,u=n.ctx,t.abrupt("return",new Promise((function(t,e){var s=new window.Image,d=(a=m(a)).split("?"),h=Object(f.a)(d,2),p=h[0],l=h[1],g=b.a.stringify({time:(new Date).valueOf()});a=p+"?"+g+l,n.canvasConfig.debug&&console.log("[drawImageUrl]:"+a),s.crossOrigin="anonymous",s.src=a,s.onload=function(){u.drawImage(s,r,i,c,o),t()},s.onerror=function(t){e(t)}})));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.drawShadeMaskImage=function(){var t=Object(u.a)(s.a.mark((function t(e){var a,r,i,c,o,u,d;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.url,r=e.x,i=e.y,c=e.width,o=e.height,u=1-(u=e.percent),(d=n.ctx).save(),d.strokeStyle="rgba(255,255,255,0)",d.beginPath(),d.moveTo(0,o*u),d.bezierCurveTo(.25*c,o*u*1.5,.75*c,o*u*.5,c,o*u),d.lineTo(c,o),d.lineTo(0,o),d.lineTo(0,o*u),d.stroke(),d.clip(),t.next=15,n.drawImage({url:a,x:r,y:i,width:c,height:o});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.insertRoot=function(){var t=n.canvasConfig.rootId;window.document.getElementById(t).append(n.c)},this.downloadImg=Object(u.a)(s.a.mark((function t(){var e,a,r,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.canvasConfig.id,a=n.c,t.next=4,new Promise((function(t,e){a.toBlob((function(e){var n=window.URL.createObjectURL(e);t(n)}))}));case 4:r=t.sent,(i=window.document.createElement("a")).download="".concat(e,".png"),i.href=r,i.click();case 9:case"end":return t.stop()}}),t)}))),this.render=Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.startDraw();case 3:return t.next=5,n.insertRoot();case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),n.canvasConfig.debug&&console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));var a=e.debug,r=e.rootId,i=e.id,c=e.width,o=e.height,h=e.children,p=e.preset;this.canvasConfig={rootId:r||"root",id:i||"".concat(r,"-canvas"),width:c,height:o,debug:a||!1},this.drawList=h||[],this.ctx=null,this.preset=p,this.init()},O=function(t){var e=t.percent;return{rootId:"poster",id:"poster-canvas",width:349,height:233,debug:!1,children:[{id:"\u80cc\u666f\u56fe",type:"image",url:n(40).default,x:0,y:0,width:349,height:233},{id:"\u524d\u666f\u56fe",type:"shadeMaskImage",url:n(41).default,x:0,y:0,width:349,height:233,percent:e}]}},k=n(0),y=function(t){Object(p.a)(n,t);var e=Object(l.a)(n);function n(t){var a;return Object(d.a)(this,n),(a=e.call(this,t)).renderCanvas=Object(u.a)(s.a.mark((function t(){var e;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=O({percent:a.state.percent/100}),a.fastCanvas=new j(e),t.next=4,a.fastCanvas.render();case 4:case"end":return t.stop()}}),t)}))),a.updatePercent=function(){console.log(a.textInput.current.value),a.setState({percent:a.textInput.current.value},(function(){a.renderCanvas()}))},a.textInput=r.a.createRef(),a.state={percent:50},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){console.log("update"),this.renderCanvas()}},{key:"render",value:function(){var t=this.state.percent;return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("input",{type:"number",step:"1",min:"0",max:"100",ref:this.textInput,defaultValue:t}),Object(k.jsx)("button",{onClick:this.updatePercent,children:"update percent"}),Object(k.jsxs)("div",{children:["display percent: ",t,"%"]}),Object(k.jsx)("div",{id:"poster"})]})}}]),n}(a.Component);var C=function(){return Object(k.jsx)("div",{className:"App",children:Object(k.jsx)(y,{})})};c.a.render(Object(k.jsx)(r.a.StrictMode,{children:Object(k.jsx)(C,{})}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.ac47e4de.chunk.js.map